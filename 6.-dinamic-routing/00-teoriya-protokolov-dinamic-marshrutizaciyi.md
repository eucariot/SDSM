# Теория протоколов динамической маршрутизации

Для начала разберемся с понятием “динамическая маршрутизация”. До сего момента мы использовали так называемую статическую маршрутизацию, то есть прописывали руками таблицу маршрутизации на каждом роутере. Использование протоколов маршрутизации позволяет нам избежать этого нудного однообразного процесса и ошибок, связанных с человеческим фактором. Как понятно из названия, эти протоколы призваны строить таблицы маршрутизации сами, **автоматически**, исходя из текущей конфигурации сети. В общем, вещь нужная, особенно когда ваша сеть это не 3 роутера, а 30, например.  
Помимо удобства есть и другие аспекты. Например, **отказоустойчивость**. Имея сеть со статической маршрутизацией, вам крайне сложно будет организовать резервные каналы — некому отслеживать доступность того или иного сегмента.

![](http://img-fotki.yandex.ru/get/6411/83739833.1f/0_9c865_87a035ec_L.jpg)

Например, если в такой сети разорвать линк между R2 и R3, то пакеты с R1 будут уходить по прежнему на R2, где будут уничтожены, потому что их некуда отправить.

![](http://img-fotki.yandex.ru/get/6412/83739833.1f/0_9c866_60569206_L.jpg)

Протоколы динамической маршрутизации в течение нескольких секунд \(а то и миллисекунд\) узнают о проблемах на сети и перестраивают свои таблицы маршрутизации, и в вышеописанном случае пакеты будут отправляться уже по актуальному маршруту

![](http://img-fotki.yandex.ru/get/6511/83739833.1f/0_9c867_d085ec2b_L.jpg)

Ещё один важный момент — **балансировка трафика**. Протоколы динамической маршрутизации практически из коробки поддерживают эту фичу и вам не нужно добавлять избыточные маршруты вручную, высчитывая их.

Ну и внедрение динамической маршрутизации сильно облегчает **масштабирование сети**. Когда вы добавляете новый элемент в сеть или подсеть на существующем маршрутизаторе, вам нужно выполнить всего несколько действий, чтобы всё заработало и вероятность ошибки минимальна, при этом информация об изменениях мгновенно расходится по всем устройствам. Ровно то же самое можно сказать и о глобальных изменениях топологии.

Все протоколы маршрутизации можно разделить на две большие группы: внешние \(**EGP** — Exterior Gateway Protocol\) и внутренние \(**IGP** — Interior Gateway Protocol\). Чтобы объяснить различия между ними, нам потребуется термин “автономная система”. В общем смысле, автономной системой \(доменом маршрутизации\) называется группа роутеров, находящихся под общим управлением.  
В случае нашей обновлённой сети AS будет такой:

![](http://img-fotki.yandex.ru/get/6611/83739833.1f/0_9c861_25440ef7_XL.jpg)

Так вот, протоколы внутренней маршрутизации используются внутри автономной системы, а внешние — для соединения автономных систем между собой. В свою очередь, внутренние протоколы маршрутизации подразделяются на **Distance-Vector** \(RIP, IGRP, EIGRP\) и **Link State** \(OSPF, IS-IS\). В этой статье мы не будем пинать трупы затрагивать протоколы RIP и IGRP в силу их почтенного возраста, а так же IS-IS в силу его отсутствия в ПТ.

Коренные различия между этими двумя видами состоят в следующем:  
1\) типе информации, которой обмениваются роутеры: таблицы маршрутизации у Distance-Vector и таблицы топологии у Link State,  
2\) процессе выбора лучшего маршрута,  
3\) количестве информации о сети, которое “держит в голове” каждый роутер: Distance-Vector знает только своих соседей, Link State имеет представление обо всей сети.

Как мы видим, количество протоколов маршрутизации невелико, но все же не один-два. А что будет, если на роутере запустить несколько протоколов одновременно? Может оказаться, что у каждого протокола будет свое мнение о том, как лучше добраться до определенной сети. А если у нас еще и статические маршруты настроены? Кому роутер отдаст предпочтение и чей маршрут добавит в таблицу маршрутизации? Ответ на этот вопрос связан с новым термином: административная дистанция \(на наш вкус, довольно посредственная калька с английского Аdministrative distance, но лучше выдумать не смогли\). Аdministrative distance это целое число от 0 до 255, выражающее “меру доверия” роутера к данному маршруту. Чем меньше AD, тем больше доверия. Вот табличка такого доверия с точки зрения Cisco:

| Протокол | Административная дистанция |
| :--- | :--- |
| Connected interface | 0 |
| Static route | 1 |
| Enhanced Interior Gateway Routing Protocol \(EIGRP\) summary route | 5 |
| External Border Gateway Protocol \(BGP\) | 20 |
| Internal EIGRP | 90 |
| IGRP | 100 |
| OSPF | 110 |
| Intermediate System-to-Intermediate System \(IS-IS\) | 115 |
| Routing Information Protocol \(RIP\) | 120 |
| Exterior Gateway Protocol \(EGP\) | 140 |
| On Demand Routing \(ODR\) | 160 |
| External EIGRP | 170 |
| Internal BGP | 200 |
| Unknown | 255 |

В сегодняшней статье мы разберём OSPF и EIGRP. Первый вам будет встречаться везде и постоянно, а второй очень хорош в сетях, где присутствует только оборудование Cisco.  
У каждого из них есть свои достоинства и недостатки. Можно сказать, что EIGRP выигрывает перед OSPF, но все плюсы нивелируются его проприетарностью. EIGRP — фирменный протокол Cisco и больше никто его не поддерживает.  
На самом деле у EIGRP много недостатков, но об этом не особо распространяются в популярных статьях. Вот только одна из проблем: [SIA](http://telecomtest.com.au/datasheets/packet-design/siawp.pdf)

Итак, приступим.

